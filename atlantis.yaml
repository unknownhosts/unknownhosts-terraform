version: 3
projects:
- name : prod-project
  dir: services/mgmt/ec2
  workspace: prod
  autoplan:
    when_modified: ["../modules/**/*.tf", "*.tf*"]
    enabled: true
  workflow: myworkflow

- name : dev-project
  dir: services/mgmt/ec2
  workspace: dev
  autoplan:
    when_modified: ["../modules/**/*.tf", "*.tf*"]
    enabled: false
  workflow: myworkflow

workflows:
  myworkflow:
    plan:
      steps:
      - run: terraform init -backend-config=backend.hcl
      - run: terraform plan